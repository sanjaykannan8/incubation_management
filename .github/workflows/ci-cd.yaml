name: CI/CD Pipeline for EKS Services

on:
  push:
    branches:
      - main   # Trigger workflow on push to main branch

jobs:
  build-deploy:
    runs-on: ubuntu-latest

    steps:
    # ğŸ“‚ Checkout repository
    - name: Checkout repository
      uses: actions/checkout@v4

    # ğŸ”‘ Docker Hub login
    - name: Log in to Docker Hub
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}

    # ğŸ³ Build & push COE API image
    - name: Build and push COE API
      run: |
        echo "âœ… Building COE API..."
        docker build -t ${{ secrets.DOCKER_USERNAME }}/coe_api:latest ./COE_Api
        docker push ${{ secrets.DOCKER_USERNAME }}/coe_api:latest

    # ğŸ³ Build & push Incubation Backend image
    - name: Build and push Incubation Backend
      run: |
        docker build -t ${{ secrets.DOCKER_USERNAME }}/coe_incubation_api:latest ./Incubation_Backend
        docker push ${{ secrets.DOCKER_USERNAME }}/coe_incubation_api:latest

    # ğŸ³ Build & push Project Management Service
    - name: Build and push Project Management Service
      run: |
        docker build -t ${{ secrets.DOCKER_USERNAME }}/project_api:latest ./Project-Management-ims
        docker push ${{ secrets.DOCKER_USERNAME }}/project_api:latest

    # ğŸ³ Build & push Student Service
    - name: Build and push Student Service
      run: |
        docker build -t ${{ secrets.DOCKER_USERNAME }}/student_api:latest ./student_management/backend
        docker push ${{ secrets.DOCKER_USERNAME }}/student_api:latest
